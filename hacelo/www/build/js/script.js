"use-strict";var config_path="partials/",nacion=angular.module("nacion",["ngRoute","ngAnimate"]);nacion.config(["$routeProvider",function($routeProvider){$routeProvider.when("/",{templateUrl:config_path+"index.html",controller:"nacion_controller"}).when("/imprimir",{templateUrl:config_path+"print.html",controller:"nacion_controller"}).when("/more2",{templateUrl:config_path+"index.html",controller:"nacion_controller"}).when("/photo",{templateUrl:config_path+"photo.html"}).when("/pick",{templateUrl:config_path+"pick.html",controller:"pick_controller"}).when("/instagram",{templateUrl:config_path+"instagram.html",controller:"pick_controller"}).when("/market",{templateUrl:config_path+"carrito.html",controller:"nacion_market"}).otherwise({redirectTo:function(){return"failed"}})}]),nacion.service("nacion_service",function(){this.url=[],this.instagram_pictures=[],this.entire_ins_pics=[],this.orders=[],this.insert_url=function(url){this.url.push(url)},this.return_url=function(){return this.url},this.set_entire_ins_pics=function(data){this.entire_ins_pics=data},this.get_entire_ins_pics=function(){return this.entire_ins_pics},this.insertInstagram_picture=function(){this.instagram_pictures.push()},this.get_Instagram_picture=function(){return this.instagram_pictures},this.return_order=function(){return this.orders},this.add_order=function(order){this.orders.push(order)}}),nacion.controller("nacion_market",["nacion_service","$scope",function(nacion_service,$scope){$scope.orders=nacion_service.return_order()}]),nacion.controller("nacion_controller",["nacion_service","$scope",function(nacion_service,$scope){$scope.url=nacion_service.return_url(),$scope.data="nacion_test",$scope.init_instagram=function(){var instagram_v=new Instagram;instagram_v.init()},$scope.insert_crop=function(url,event){var width=$("#"+event.toElement.id).width(),height=$("#"+event.toElement.id).height();dkrm=new Darkroom("#"+event.toElement.id,{minWidth:0,minHeight:0,maxWidth:width,maxHeight:height,plugins:{crop:{quickCropKey:67,ratio:1}},init:function(){var cropPlugin=this.getPlugin("crop");cropPlugin.selectZone(170,25,300,300)}})},$scope.insert_url=function(url){nacion_service.insert_url(url),$scope.url=nacion_service.return_url()},document.addEventListener("finish",function(e){$scope.url=e.detail,$scope.$apply()})}]),nacion.controller("pick_controller",["nacion_service","$scope",function(nacion_service,$scope){$scope.instagram_pics=nacion_service.get_entire_ins_pics(),$scope.instagram_images=[],$scope.normal_pics=[],$scope.username="",$scope.instagram=null;var username_html=$(".username-hidden-field");$scope.call_instagram=function(){if($scope.instagram="",""!=$scope.username){var instagramA=new Instagram($scope.username);instagramA.init(),username_html.removeClass("reset_value")}else hacelo.alert(messages.FILL)},$scope.call_popup=function(){$scope.instagram_pics.length>0?window.location.hash="#/instagram":username_html.addClass("reset_value")},$scope.pick_song=function(index){$scope.instagram_pics[index].picked=$scope.instagram_pics[index].picked?!1:!0},document.addEventListener("_EMPTY",function(){nacion_service.set_entire_ins_pics(null),$scope.instagram_pics=nacion_service.get_entire_ins_pics()}),document.addEventListener("finish",function(e){$scope.instagram_pics=e.detail;for(var array=[],el=0;el<$scope.instagram_pics.length;el++){var obj={img:$scope.instagram_pics[el],picked:!1};array.push(obj)}$scope.instagram_pics=array,nacion_service.set_entire_ins_pics($scope.instagram_pics),$scope.$apply(),$scope.instagram_pics.length>0&&(window.location.hash="#/instagram")})}]),window.messages={EMPTY:"No hay iamgenes la cuenta!",NO_EXIST:"El usuario no existe!",FILL:"Por favor, llenar los campos!"},window.Instagram=function(username){this.user_url="https://api.instagram.com/v1/users/",this.client_id="3a82fedae1534af2b582fe5133dec98c",this.redirect_uri="http://yahoo.com",this.url="https://instagram.com/oauth/authorize/?client_id="+this.client_id+"&redirect_uri="+this.redirect_uri+"&response_type=token",this.access_token="",this.username=username,this.user_id="",this.img="",this.tab={},this.img_template={images:[]},this.canvas_width=$(window).width()-20,this.array_angular=[]},window.Instagram.prototype={init:function(){this.tab=window.open(encodeURI(this.url),"_blank","location=yes,clearcache=no"),this.bind_events()},bind_events:function(){var self=this;this.tab.addEventListener("loadstop",function(e){var el=e.url.split("access_token=");void 0!=typeof el[1]&&(self.access_token=el[1]),self.found_access_code(el)})},fetch:function(url,data,callback){var self=this;$.ajax({url:url,type:"GET",data:data,crossDomain:!0,dataType:"jsonp",jsonpCallback:"callback",success:function(e){callback(e,self)},error:function(jqXHR,textStatus,errorThrown){console.debug(jqXHR),console.debug(errorThrown)}})},insert_images:function(response,self){if(console.debug(response),$(".images-hidden *").remove(),response.data.length<=0)hacelo.alert(messages.EMPTY),createEvent("_EMPTY");else{for(var array=new Array,obj=new Object,img="",counter=0,count="",img_encode=null,els=0;els<response.data.length;els++)obj={url:response.data[els].images.standard_resolution},array.push(obj),img+="<img class='img_test' src='"+response.data[els].images.standard_resolution.url+"' id='image_id_"+counter+"'/>",counter++;self.img_template.images=array,$(img).appendTo(".images-hidden"),setTimeout(function(){count=$(".img_test").length,img_encode=$(".img_test");for(var x=0;count>x;x++)console.debug(img_encode[x].id),console.log(self.convert_img_to_encode(img_encode[x].id)),self.array_angular.push(self.convert_img_to_encode(img_encode[x].id));self.createEvent("finish",self.array_angular)},400)}},get_user_id:function(data,scope){if(data.data.length<=0)hacelo.alert(messages.NO_EXIST);else{console.debug(data.data[0].id);var self=scope;self.user_id=data.data[0].id,self.fetch("https://api.instagram.com/v1/users/"+self.user_id+"/media/recent","access_token="+self.access_token,self.insert_images)}},found_access_code:function(data){2==data.length&&(this.tab.close(),this.fetch("https://api.instagram.com/v1/users/search","q="+this.username+"&access_token="+this.access_token,this.get_user_id))},convert_img_to_encode:function(id){var height,width,ratio,img=document.getElementById(id),canvas=document.createElement("canvas");width=img.width,height=img.height,ratio=width/height,ratio=this.canvas_width/ratio,canvas.width=this.canvas_width,canvas.height=ratio;var ctx=canvas.getContext("2d");return ctx.drawImage(img,0,0,this.canvas_width,ratio),$(canvas).appendTo(".images-hidden"),window.dataURL=canvas.toDataURL("image/png"),$('<img src="'+window.dataURL+'"/>').appendTo(".images-hidden"),window.dataURL},createEvent:function(text,data){var event;event=void 0!=data?new CustomEvent(text,{detail:data}):new CustomEvent(text),document.dispatchEvent(event)}},window.Instagram=window.Instagram||{};var template_engine=function(json,template_id){this.json=json,this.template_id=template_id};template_engine.prototype={register_helper:function(id,callback){Handlerbars.registerHelper(id,callback)},register_custom_class_helper:function(){Handlerbars.registerHelper("canvas",function(){})},add_and_create_template:function(){var source=$("#"+this.template_id).html(),template=Handlebars.compile(source),html=template(this.json);console.debug(html)}},function(){window.hacelo=window.hacelo||{},window.hacelo={alert:function(string){alert(string)}}}();