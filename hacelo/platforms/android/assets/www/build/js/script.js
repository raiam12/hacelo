"use-strict";var nacion=angular.module("nacion",["ngRoute","ngAnimate"]);nacion.config(["$routeProvider",function($routeProvider){$routeProvider.when("/",{templateUrl:"partials/index.html",controller:"nacion_controller"}).when("/more",{templateUrl:"partials/second.html",controller:"nacion_controller"}).when("/more2",{templateUrl:"partials/index.html",controller:"nacion_controller"}).otherwise({redirectTo:function(){return"failed"}})}]),nacion.service("nacion_service",function(){this.url=[],this.insert_url=function(url){this.url.push(url)},this.return_url=function(){return this.url}}),nacion.controller("nacion_controller",["nacion_service","$scope",function(nacion_service,$scope){$scope.url=nacion_service.return_url(),$scope.data="nacion_test",$scope.init_instagram=function(){var instagram_v=new Instagram;instagram_v.init()},$scope.insert_crop=function(url,event){var width=$("#"+event.toElement.id).width(),height=$("#"+event.toElement.id).height();dkrm=new Darkroom("#"+event.toElement.id,{minWidth:0,minHeight:0,maxWidth:width,maxHeight:height,plugins:{crop:{quickCropKey:67,ratio:1}},init:function(){var cropPlugin=this.getPlugin("crop");cropPlugin.selectZone(170,25,300,300)}})},$scope.insert_url=function(url){nacion_service.insert_url(url),$scope.url=nacion_service.return_url()},document.addEventListener("finish",function(e){$scope.url=e.detail,$scope.$apply()})}]),window.Instagram=function(){this.user_url="https://api.instagram.com/v1/users/",this.client_id="3a82fedae1534af2b582fe5133dec98c",this.redirect_uri="http://yahoo.com",this.url="https://instagram.com/oauth/authorize/?client_id="+this.client_id+"&redirect_uri="+this.redirect_uri+"&response_type=token",this.access_token="",this.username="raiamquesada",this.user_id="",this.img="",this.tab={},this.img_template={images:[]},this.canvas_width=$(window).width()-20,this.array_angular=[]},window.Instagram.prototype={init:function(){this.tab=window.open(encodeURI(this.url),"_blank","location=yes,clearcache=yes"),this.bind_events()},bind_events:function(){var self=this;this.tab.addEventListener("loadstop",function(e){var el=e.url.split("access_token=");void 0!=typeof el[1]&&(self.access_token=el[1]),self.found_access_code(el)})},fetch:function(url,data,callback){var self=this;$.ajax({url:url,type:"GET",data:data,crossDomain:!0,dataType:"jsonp",jsonpCallback:"callback",success:function(e){callback(e,self)},error:function(jqXHR,textStatus,errorThrown){console.debug(jqXHR),console.debug(errorThrown)}})},insert_images:function(response,self){console.debug(response);for(var array=new Array,obj=new Object,img="",counter=0,count="",img_encode=null,els=0;els<response.data.length;els++)obj={url:response.data[els].images.standard_resolution},array.push(obj),img+="<img class='img_test' src='"+response.data[els].images.standard_resolution.url+"' id='image_id_"+counter+"'/>",counter++;self.img_template.images=array,$(img).appendTo(".images-hidden"),setTimeout(function(){count=$(".img_test").length,img_encode=$(".img_test");for(var x=0;count>x;x++)self.array_angular.push(self.convert_img_to_encode(img_encode[x].id));self.createEvent("finish",self.array_angular)},400)},get_user_id:function(data,scope){var self=scope;self.user_id=data.data[0].id,self.fetch("https://api.instagram.com/v1/users/"+self.user_id+"/media/recent","access_token="+self.access_token,self.insert_images)},found_access_code:function(data){2==data.length&&(this.tab.close(),this.fetch("https://api.instagram.com/v1/users/search","q="+this.username+"&access_token="+this.access_token,this.get_user_id))},convert_img_to_encode:function(id){var height,width,ratio,img=document.getElementById(id),canvas=document.createElement("canvas");width=img.width,height=img.height,ratio=width/height,ratio=this.canvas_width/ratio,canvas.width=this.canvas_width,canvas.height=ratio;var ctx=canvas.getContext("2d");return ctx.drawImage(img,0,0,this.canvas_width,ratio),$(canvas).appendTo(".images-hidden"),window.dataURL=canvas.toDataURL("image/png"),$('<img src="'+window.dataURL+'"/>').appendTo(".images-hidden"),window.dataURL},createEvent:function(text,data){var event;event=void 0!=data?new CustomEvent(text,{detail:data}):new CustomEvent(text),document.dispatchEvent(event)}},window.Instagram=window.Instagram||{};var template_engine=function(json,template_id){this.json=json,this.template_id=template_id};template_engine.prototype={register_helper:function(id,callback){Handlerbars.registerHelper(id,callback)},register_custom_class_helper:function(){Handlerbars.registerHelper("canvas",function(){})},add_and_create_template:function(){var source=$("#"+this.template_id).html(),template=Handlebars.compile(source),html=template(this.json);console.debug(html)}},function(){function add_events(){$("body").delegate("a","click",function(){dkrm=new Darkroom("#target",{minWidth:0,minHeight:0,maxWidth:320,maxHeight:240,plugins:{crop:{quickCropKey:67,ratio:1}},init:function(){var cropPlugin=this.getPlugin("crop");cropPlugin.selectZone(170,25,300,300)}})}),$(".ingresar-data").on("click",function(){$(".main-content").css("-webkit-transform","translate3d(-33%,0,0)")})}window.strings=window.strings||{};var upload_template,login_template,dkrm;!function(){$.getJSON("config/strings.json",function(data){var template=new fit_template(data);upload_template=template.get_full_template("#login-picture"),login_template=template.get_full_template("#login-picture"),$(upload_template).appendTo("body"),add_events()})}();var fit_template=function(strings){this.strings=strings};fit_template.prototype={get_full_template:function(id){var html=$(id).html(),template=Handlebars.compile(html);return template(this.strings)}}}();